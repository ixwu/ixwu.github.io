<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ä¸€ä¸ª jar åŒ…å¯åŠ¨è„šæœ¬ | ä¹ å¾å­¦</title>
<meta name="description" content="A Life-long Learner" />
<link rel="shortcut icon" href="https://ixwu.github.io/favicon.ico">
<link rel="stylesheet" href="https://ixwu.github.io/styles/main.css">

<script src="https://ixwu.github.io/media/js/jquery.min.js"></script>
<script src="https://ixwu.github.io/media/js/masonry.pkgd.min.js"></script>
<script src="https://ixwu.github.io/media/js/aos.js"></script>
<script src="https://ixwu.github.io/media/js/pace.min.js"></script>
<script src="https://ixwu.github.io/media/js/view-image.min.js"></script>
<script src="https://ixwu.github.io/media/js/jquery.magnific-popup.min.js"></script>
<script src="https://ixwu.github.io/media/js/functions.js"></script>
    <meta name="referrer" content="never">
    <meta name="description" content="ä¸€ä¸ªå¯ jar åŒ…çš„è„šæœ¬ï¼Œä½ å¸Œæœ›å®ƒè¿˜èƒ½æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ
æˆ‘å¸Œæœ›å®ƒè¿˜èƒ½åœæ­¢ï¼Œé‡å¯ï¼Œä¸Šçº¿ï¼Œå›æ»šï¼Œèƒ½æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼Œèƒ½æŸ¥çœ‹æ—¥å¿—ï¼Œäºæ˜¯æœ‰äº†ä¸‹é¢è¿™ä¸ªè„šæœ¬ã€‚
å¦‚ä½•ä½¿ç”¨ï¼Ÿ
# åœ¨ä½ æ”¾è„šæœ¬çš„åœ°æ–¹æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ä¸‹è½½è„šæœ¬ï¼Œæœ¬ä¾‹æ˜¯æ”¾åœ¨rootç›®å½•ä¸‹
[root@lo..." />
    <meta name="keywords" content="shell" />
    <script src="https://ixwu.github.io/media/js/waterfall.min.js"></script>
    <script src="https://ixwu.github.io/media/js/prism.min.js"></script>
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href="https://ixwu.github.io"><img src="/media/images/logoo.png" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="https://ixwu.github.io" class="menu">é¦–é¡µ</a></li>
                
                  <li class="" >
                    <a href="/books" class="menu">
                      é˜…è¯»
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/movies" class="menu">
                      è§‚å½±
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      å½’æ¡£
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/friends" class="menu">
                      å‹é“¾
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1588691610220" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="æœç‚¹å•¥..." aria-label="æœç‚¹å•¥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=750&amp;q=80');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="2018-12-27"><i class="fa fa-calendar"></i><span class="lately">1 å¹´å‰</span></time>
              
            </div>
            <div class="info">
              <div class="tags ">
                
                      <a href="https://ixwu.github.io/tag/shell/" class="ctag ctag-0 ctag-shell" aria-label="">shell</a>
                    
              </div>
              <h1 class="title ularge white bold">ä¸€ä¸ª jar åŒ…å¯åŠ¨è„šæœ¬</h1>
            </div>
          </div>
        </div>  

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <p>ä¸€ä¸ªå¯ jar åŒ…çš„è„šæœ¬ï¼Œä½ å¸Œæœ›å®ƒè¿˜èƒ½æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ</p>
<p>æˆ‘å¸Œæœ›å®ƒè¿˜èƒ½<strong>åœæ­¢</strong>ï¼Œ<strong>é‡å¯</strong>ï¼Œ<strong>ä¸Šçº¿</strong>ï¼Œ<strong>å›æ»š</strong>ï¼Œèƒ½<strong>æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</strong>ï¼Œèƒ½<strong>æŸ¥çœ‹æ—¥å¿—</strong>ï¼Œäºæ˜¯æœ‰äº†ä¸‹é¢è¿™ä¸ªè„šæœ¬ã€‚</p>
<h2 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h2>
<pre><code class="language-bash"># åœ¨ä½ æ”¾è„šæœ¬çš„åœ°æ–¹æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ä¸‹è½½è„šæœ¬ï¼Œæœ¬ä¾‹æ˜¯æ”¾åœ¨rootç›®å½•ä¸‹
[root@localhost ~]# curl -s https://devops.xwlearn.com/shell/boot-jar.sh &gt; boot-jar.sh

# æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©
[root@localhost ~]# bash boot-jar.sh 
========================================================================
 usage: boot-jar.sh [option] ... [start | stop | status | restart | log | upgrade]
 bash boot-jar.sh start        : start service			# å¯åŠ¨æœåŠ¡
 bash boot-jar.sh stop         : stop service			# åœæ­¢æœåŠ¡
 bash boot-jar.sh status       : service status			# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
 bash boot-jar.sh log          : service log			# æŸ¥çœ‹æ—¥å¿—
 bash boot-jar.sh restart      : restart service		# é‡å¯æœåŠ¡
 bash boot-jar.sh upgrade/up   : upgrade service		# æ›´æ–°åŒ…
 bash boot-jar.sh rollback/back: rollback service		# å›æ»šåŒ…
========================================================================

# ä¿®æ”¹å˜é‡

[root@localhost ~]# vim boot-jar.sh 
UPLOAD_PATH=                    		# ä¸ŠåŒ…ç›®å½•ï¼Œå¦‚/opt/upload
DEPLOY_PATH=            				# jaråŒ…å®‰è£…è·¯å¾„,å¦‚/opt/test
PACKAGE_NAME= 							# jaråŒ…å,å¦‚test-hello-1.0.0.jar
SERVICE_NAME=${PACKAGE_NAME%-*}         # å»æ‰åç¼€åŠç‰ˆæœ¬å·,æœ¬ä¾‹ä¸ºtest-hello
LOG_NAME=${SERVICE_NAME}.log            # æ—¥å¿—åï¼Œæœ¬ä¾‹ä¸ºtest-hello.log
ACTIVE=&quot;test&quot;                           # å¯åŠ¨ç›¸åº”ç¯å¢ƒé…ç½®ï¼Œå¦‚test|pre|pro
PACKAGE_PATH=$DEPLOY_PATH/$PACKAGE_NAME # å®‰è£…åŒ…è·¯å¾„,æœ¬ä¾‹ä¸º /opt/test/test-hello-1.0.0.jar
LOG_PATH=$DEPLOY_PATH/logs/$LOG_NAME    # æ—¥å¿—è·¯å¾„,æœ¬ä¾‹ä¸º /opt/test/logs/test-hello.log
BACKUP_PATH=$DEPLOY_PATH/backup         # å¤‡ä»½ç›®å½•,æœ¬ä¾‹ä¸º /opt/test/backup
BACKUP_LAST=$(find $BACKUP_PATH -name &quot;${PACKAGE_NAME}*&quot; | xargs ls -t | head -1)
BACKUP_LAST_NAME=$(basename $BACKUP_LAST)  # ä¸Šä¸€ä¸ªå¤‡ä»½åŒ…æ–‡ä»¶å
......

# æŒ‰ç…§ä¸Šé¢ä¾‹å­ï¼Œéœ€æå‰åˆ›å»ºå¥½ç›¸å…³ç›®å½•

ä¸ŠåŒ…ç›®å½•	/opt/upload
jaråŒ…å®‰è£…ç›®å½•	/opt/test
æ—¥å¿—ç›®å½•	/opt/test/logs
å¤‡ä»½ç›®å½•	/opt/test/backup

# è¿™é‡Œåˆ©ç”¨èŠ±æ‹¬å·çš„æ‰©å±•åŠŸèƒ½å¿«é€Ÿåˆ›å»ºç›®å½•åŠå­ç›®å½•ï¼Œä¸‹é¢è„šæœ¬ä¸­ä¼šæœ‰èŠ±æ‹¬å·å¦ä¸€ä¸ªå¦™ç”¨

[root@localhost ~]# mkdir -p /opt/{upload,test/{logs,backup}}
[root@localhost ~]# tree /opt
[root@vultr ~]# tree -L 2 /opt
/opt
â”œâ”€â”€ test
â”‚Â Â  â”œâ”€â”€ backup
â”‚Â Â  â””â”€â”€ logs
â”œâ”€â”€ upload
...

# æŠŠä½ çš„jaråŒ…æ”¾å…¥ /opt/upload å°±è¡Œäº†

[root@localhost ~]# bash boot-jar.sh upload		# ä¸ŠåŒ…å¹¶å¯åŠ¨æœåŠ¡
[root@localhost ~]# bash boot-jar.sh status		# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

# è¿˜å¯ä»¥æŠŠä½ çš„è„šæœ¬ç›®å½•æ”¾å…¥pathï¼Œå°±å¯ä»¥å…¨å±€æ‰§è¡Œäº†

[root@localhost ~]# chmod u+x boot-jar.sh
[root@localhost ~]# vim /etc/profile.d/boot-jar.sh
export PATH=&quot;$PATH:/root&quot;
[root@localhost ~]# source /etc/profile.d/boot-jar.sh
[root@localhost ~]# boot-jar.sh upload		# ä¸ŠåŒ…å¹¶å¯åŠ¨æœåŠ¡
[root@localhost ~]# boot-jar.sh status		# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
[root@localhost ~]# boot-jar.sh log		        # æŸ¥çœ‹æ—¥å¿—
......
</code></pre>
<p>åœ¨å±•ç¤ºå®Œæ•´è„šæœ¬å‰ï¼Œæˆ‘å…ˆä»‹ç»ä¸‹å®ƒçš„å‡ ä¸ªäº®ç‚¹ã€‚</p>
<h2 id="å¦‚ä½•åˆ¤æ–­æŸç¨‹åºæ˜¯å¦å®‰è£…">å¦‚ä½•åˆ¤æ–­æŸç¨‹åºæ˜¯å¦å®‰è£…ï¼Ÿ</h2>
<pre><code class="language-bash"># æ¯”å¦‚ java 
[root@localhost ~]#  command -v java
</code></pre>
<h3 id="ä¸ºä»€ä¹ˆç”¨-command-åˆ¤æ–­è€Œé-which">ä¸ºä»€ä¹ˆç”¨ command åˆ¤æ–­ï¼Ÿè€Œé which</h3>
<p>command æ˜¯ bash å†…ç½®å‘½ä»¤ï¼Œæ€§èƒ½æ›´å¥½; è€Œ which æ˜¯å¤–éƒ¨å‘½ä»¤ï¼Œæ€§èƒ½ä½äº›ï¼Œè¿™è¿˜ä¸æ˜¯ä¸»è¦çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªå‘½ä»¤çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>Run command with args suppressing the normal shell function lookup. Only builtin commands or commands found in the PATH are executed<br>
If either the  -V or  -v  option  is  supplied, a description of command is printed<br>
......<br>
If the -V or -v option is supplied, the exit status  is  0  if  command  was found, and 1 if not.</p>
</blockquote>
<p>ç”±ä¸Šå¯çŸ¥ï¼Œcommandæ˜¯è¿è¡Œç³»ç»ŸçœŸæ­£çš„å‘½ä»¤ï¼Œè€Œéåˆ«åã€‚æ¢ç§è¯´æ³•ï¼Œä½ å…ˆæŸ¥çœ‹ä¸‹ä½ çš„<code>ls</code>å‘½ä»¤åˆ«å</p>
<pre><code class="language-bash">[root@localhost ~]# alias ls
alias ls='ls --color=auto'
</code></pre>
<p>æ‰€ä»¥è¯´ä½ é”®å…¥<code>ls</code>å‘½ä»¤æ—¶ï¼Œå®é™…è¿è¡Œçš„æ˜¯<code>ls --color=auto</code>ï¼Œå‡å¦‚æœ‰äººæŠŠ<code>ls</code>å˜æˆ<code>rm -rf /</code>ï¼Œä½ æ˜¯ä¸æ˜¯è¯¥è·‘è·¯äº†ï¼Ÿ</p>
<p>commandå‘½ä»¤èƒ½è®©ä½ åªè¿è¡ŒçœŸæ­£çš„<code>ls</code>ï¼Œè€Œéå…¶åˆ«åã€‚å…¶<code>-v</code>é€‰é¡¹æ˜¯æ‰“å°ç»™å®šå‘½ä»¤çš„ç®€è¦æè¿°ï¼Œæ˜¯åˆ«åçš„è¾“å‡ºåˆ«åï¼Œä¸æ˜¯çš„æ‰“å°å…¶å‘½ä»¤è·¯å¾„ï¼Œå†…ç½®å‘½ä»¤å°±è¾“å‡ºå…¶åç§°ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæ˜ç¡®å‘Šè¯‰ä½ ï¼Œå¦‚æœæ‰¾åˆ°äº†å‘½ä»¤ï¼Œå°±é€€å‡º0ï¼Œæ‰¾ä¸åˆ°å°±é€€å‡º1ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨è¿™ç‚¹åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å®‰è£…æŸå‘½ä»¤ï¼Œæ³¨æ„ï¼Œå¦‚æœä½ å®‰è£…äº†æŸåº”ç”¨ï¼Œä½†æ˜¯æ²¡æœ‰æŠŠå®ƒåŠ å…¥PATHï¼Œé‚£å°±æ²¡æ³•åˆ¤æ–­äº†ã€‚</p>
<p>å†æ¥çœ‹çœ‹which</p>
<blockquote>
<p>shows the full path of (shell) commands</p>
<p>Which returns the number of failed arguments, or -1 when no `programnameÂ´ was given</p>
</blockquote>
<p>which ä¸»è¦æ˜¯ç”¨æ¥å¯»æ‰¾å‘½ä»¤çš„å®Œæ•´è·¯å¾„ï¼Œå…¶è¿”å›å€¼æ˜¯å¤±è´¥å‚æ•°ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯è¯´whichåé¢å¯è·Ÿå¤šä¸ªå‚æ•°ï¼Œéƒ½æ‰¾åˆ°äº†å°±è¿”å›0ï¼Œå¤±è´¥ä¸€ä¸ªè¿”å›1ï¼Œå¤±è´¥nä¸ªè¿”å›nã€‚æ²¡æœ‰ç»™å®šå‚æ•°ï¼Œè¿”å›-1ï¼Œä¹Ÿå°±æ˜¯255ï¼Œè¿™æ˜¯å› ä¸ºexitåªèƒ½ä½¿ç”¨0~255ä¹‹é—´çš„å€¼ï¼Œ-1 çš„unsignedå€¼ä¾¿æ˜¯255ã€‚</p>
<p>çœ‹èµ·æ¥å¥½åƒwhichä¹Ÿèƒ½æ ¹æ®è¿”å›çŠ¶æ€ç åˆ¤æ–­æŸç¨‹åºæ˜¯å¦å®‰è£…ï¼Ÿä½†æ˜¯whichæ˜¯å¤–ç½®å‘½ä»¤ï¼Œä¸åŒç³»ç»Ÿä¸Šçš„whichå®ç°æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¾ˆå¤šç³»ç»Ÿä¸Šçš„whichç”šè‡³ä¸è®¾ç½®é€€å‡ºçŠ¶æ€ç ï¼Œè¿™æ ·ä¸ç®¡ä½ æ‰¾æ²¡æ‰¾åˆ°æŸç¨‹åºï¼Œéƒ½è¿”å›0ï¼Œè¯·é—®ä½ å¦‚ä½•åˆ¤æ–­ï¼Ÿ</p>
<p>é™¤äº†commandï¼Œtypeå’Œhashè¿™ä¸¤ä¸ªå†…ç½®å‘½ä»¤ä¹Ÿå¯ä»¥åˆ¤æ–­ï¼Œå…·ä½“è¯·çœ‹<a href="https://stackoverflow.com/questions/592620/how-to-check-if-a-program-exists-from-a-bash-script/677212#677212">stackoverflow</a></p>
<h3 id="å†™æˆå‡½æ•°">å†™æˆå‡½æ•°</h3>
<pre><code class="language-bash">function check_cmd() {

    command -v $1  &gt;/dev/null 2&gt;&amp;1 || { echo &gt;&amp;2 &quot; \033[31m  $1 is not installed.  Aborting. \033[0m&quot;; exit 1; }

}
</code></pre>
<p>è¿™é‡Œçš„èŠ±æ‹¬å·å…¶å®æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæ‰€ä»¥é‡Œé¢çš„è¯­å¥æœ«å°¾éƒ½å¾—åŠ åˆ†å·ã€‚åœ¨<a href="https://www.cnblogs.com/yasmi/articles/5129571.html">è¿™é‡Œ</a>æŸ¥çœ‹æ›´å¤šshellä¸­æ‹¬å·çš„æ€»ç»“</p>
<h2 id="å¦‚ä½•è·å¾—è¿è¡Œç¨‹åºçš„pid">å¦‚ä½•è·å¾—è¿è¡Œç¨‹åºçš„pidï¼Ÿ</h2>
<p>é€šå¸¸åšæ³•æ˜¯</p>
<pre><code class="language-bash">PID=$(ps -ef |grep -v grep |grep &lt;keyword&gt; |awk '{print $2 }')
</code></pre>
<p>è¿™ç§æ–¹æ³•ä¸æ˜¯ä¸èƒ½ç”¨ï¼Œä½†æ˜¯æˆ‘è§‰å¾—ä¸å¤Ÿä¼˜é›…ï¼Œæœ€ä¼˜é›…çš„æ–¹å¼æ˜¯ä½¿ç”¨pgrepå‘½ä»¤ï¼Œä¸Šè¿°å‘½ä»¤å¯ä»¥æ”¹æˆ</p>
<pre><code class="language-bash">PID=$(pgrep -f &lt;keyword&gt;)
</code></pre>
<blockquote>
<p>The pattern is normally only matched against the process name.  When -f is set, the full command line is used.<br>
The running pgrep or pkill process will never report itself as a match</p>
</blockquote>
<h2 id="å¦‚ä½•è·å¾—ä¸Šä¸€æ¡å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°">å¦‚ä½•è·å¾—ä¸Šä¸€æ¡å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Ÿ</h2>
<p>å‘½ä»¤è¡Œä¸­å¯ä»¥ç”¨!<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">ï¼Œ</mi><mi mathvariant="normal">è¿™</mi><mi mathvariant="normal">æ˜¯</mi><mi mathvariant="normal">ä¸</mi><mi mathvariant="normal">â€˜</mi><mi>h</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">â€˜</mi><mi mathvariant="normal">å‘½</mi><mi mathvariant="normal">ä»¤</mi><mi mathvariant="normal">ç›¸</mi><mi mathvariant="normal">å…³</mi><mi mathvariant="normal">çš„</mi><mi mathvariant="normal">ç‰¹</mi><mi mathvariant="normal">æ®Š</mi><mi mathvariant="normal">å˜</mi><mi mathvariant="normal">é‡</mi><mi mathvariant="normal">ï¼Œ</mi><mi mathvariant="normal">è„š</mi><mi mathvariant="normal">æœ¬</mi><mi mathvariant="normal">ä¸­</mi><mi mathvariant="normal">å°±</mi><mi mathvariant="normal">ä¸</mi><mi mathvariant="normal">å¯</mi><mi mathvariant="normal">ä»¥</mi><mi mathvariant="normal">è¿™</mi><mi mathvariant="normal">æ ·</mi><mi mathvariant="normal">äº†</mi><mi mathvariant="normal">ï¼Œ</mi><mi mathvariant="normal">é€š</mi><mi mathvariant="normal">ç”¨</mi><mi mathvariant="normal">åš</mi><mi mathvariant="normal">æ³•</mi><mi mathvariant="normal">æ˜¯</mi><mi mathvariant="normal">â€˜</mi></mrow><annotation encoding="application/x-tex">ï¼Œè¿™æ˜¯ä¸`history`å‘½ä»¤ç›¸å…³çš„ç‰¹æ®Šå˜é‡ï¼Œè„šæœ¬ä¸­å°±ä¸å¯ä»¥è¿™æ ·äº†ï¼Œé€šç”¨åšæ³•æ˜¯`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">æ˜¯</span><span class="mord cjk_fallback">ä¸</span><span class="mord">â€˜</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord">â€˜</span><span class="mord cjk_fallback">å‘½</span><span class="mord cjk_fallback">ä»¤</span><span class="mord cjk_fallback">ç›¸</span><span class="mord cjk_fallback">å…³</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">ç‰¹</span><span class="mord cjk_fallback">æ®Š</span><span class="mord cjk_fallback">å˜</span><span class="mord cjk_fallback">é‡</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">è„š</span><span class="mord cjk_fallback">æœ¬</span><span class="mord cjk_fallback">ä¸­</span><span class="mord cjk_fallback">å°±</span><span class="mord cjk_fallback">ä¸</span><span class="mord cjk_fallback">å¯</span><span class="mord cjk_fallback">ä»¥</span><span class="mord cjk_fallback">è¿™</span><span class="mord cjk_fallback">æ ·</span><span class="mord cjk_fallback">äº†</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">é€š</span><span class="mord cjk_fallback">ç”¨</span><span class="mord cjk_fallback">åš</span><span class="mord cjk_fallback">æ³•</span><span class="mord cjk_fallback">æ˜¯</span><span class="mord">â€˜</span></span></span></span>_`ï¼Œå‘½ä»¤è¡Œå’Œè„šæœ¬ä¸­éƒ½å¯ä»¥ã€‚è¿™ä¸ªæ˜¯æˆ‘è‡ªå·±è¯•å‡ºæ¥äº†çš„ï¼Œå¢™å†…è¿˜æ²¡æ‰¾åˆ°ç›¸å…³èµ„æ–™ï¼Œåˆšåˆšä¸ºäº†å°è¯ï¼Œæ‰ç¿»äº†å¢™æ‰¾äº†æ‰¾ï¼Œæœç„¶å¦‚æˆ‘æ‰€æ–™ã€‚</p>
<pre><code class="language-bash">mkdir test &amp;&amp; cd $_    # åˆ›å»ºtestç›®å½•å¹¶è¿›å…¥
# é€šå¸¸æˆ‘ä»¬è¿›å…¥ç›®å½•å‰æœ€å¥½åˆ¤æ–­è¯¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥ç”¨ []ã€[[]]ä»¥åŠtestæ¥è¿›è¡Œæ¡ä»¶æµ‹è¯•ï¼Œä½†çŸ¥é“äº†$_åï¼Œæˆ‘é€šé€šæ”¹æˆä¸‹é¢è¿™æ ·ï¼Œå› ä¸ºç”¨äº† [ ] å’Œ [[ ]] å°±ä¸èƒ½ä½¿ç”¨$_
test -d test &amp;&amp; cd $_
# ä¸‡ä¸€ä¸å­˜åœ¨testç›®å½•ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›åˆ›å»ºåç„¶ååˆè¿›å»ï¼Œè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ
test -d test &amp;&amp; cd $_ || mkdir $_ &amp;&amp; cd $_ 
# è¿™å°±æœ‰ç‚¹å¤šä½™äº†ï¼Œæˆ‘ä»¬æ¥ä¼˜åŒ–ä¸‹
test -d test  || mkdir $_ &amp;&amp; cd $_ 
# æ‰©å±•ï¼Œåˆ é™¤æ–‡ä»¶æ—¶æˆ‘ä»¬ä¹Ÿä¼šåˆ¤æ–­ä¸‹æŸæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ¯”å¦‚
[ -f /usr/local/src/justfortest.md ] &amp;&amp; rm -f /usr/local/src/justfortest.md
# è¿™å°±æ˜¾å¾—è‡ƒè‚¿äº†ï¼Œæˆ‘ä»¬æ¥ä¼˜åŒ–ä¸‹
test -f /usr/local/src/justfortest.md &amp;&amp; rm -f $_
</code></pre>
<h2 id="å®Œæ•´è„šæœ¬">å®Œæ•´è„šæœ¬</h2>
<pre><code class="language-bash">#!/bin/bash

UPLOAD_PATH=						# ä¸ŠåŒ…ç›®å½•
DEPLOY_PATH=						# å®‰è£…è·¯å¾„
PACKAGE_NAME=						# åŒ…å
SERVICE_NAME=${PACKAGE_NAME%-*}		# åˆ‡å‰²åŒ…åï¼Œå»æ‰åç¼€åŠç‰ˆæœ¬å·
LOG_NAME=${SERVICE_NAME}.log		# æ—¥å¿—å
ACTIVE=&quot;test&quot;						# è¿è¡Œç¯å¢ƒ test|pre|pro
PACKAGE_PATH=$DEPLOY_PATH/$PACKAGE_NAME	# å®‰è£…åŒ…è·¯å¾„,å¦‚æœæ˜¯warçš„è¯, æ”¹ä¸º$DEPLOY_PATH/webapps/$PACKAGE_NAMEï¼Œ$DEPLOY_PATH å€¼ä¸ºtomcatè·¯å¾„ï¼Œå¦‚/data/tomcat
LOG_PATH=$DEPLOY_PATH/logs/$LOG_NAME	# æ—¥å¿—è·¯å¾„
BACKUP_PATH=$DEPLOY_PATH/backup			# å¤‡ä»½ç›®å½•
BACKUP_LAST=$(find $BACKUP_PATH -name &quot;${PACKAGE_NAME}*&quot; | xargs ls -t | head -1)
BACKUP_LAST_NAME=$(basename $BACKUP_LAST)

RETVAL=&quot;0&quot;

function check_ok() {

        if [ $? != 0 ] 
        then
            echo -e &quot;\033[31m ERROR! $1 \033[0m&quot;
            exit 1
        fi  
}

function check_cmd() {

    command -v $1  &gt;/dev/null 2&gt;&amp;1 || { echo &gt;&amp;2 &quot; \033[31m  $1 is not installed.  Aborting. \033[0m&quot;; exit 1; }

}

function get_pid() {

    PID=$(pgrep -f $PACKAGE_NAME)
}

function backup() {

local TIMESTAMP=$(date +%F-%H-%M)

    test -d $BACKUP_PATH || mkdir -p $_
    test -f $PACKAGE_PATH &amp;&amp; mv -b  $_ $BACKUP_PATH/${PACKAGE_NAME}_${TIMESTAMP}   
}

function upload() {


    test -d $UPLOAD_PATH || mkdir -p $_

# åˆ¤æ–­ä¸ŠåŒ…ç›®å½•æ˜¯å¦å­˜åœ¨æ–°åŒ…
    if [ -f $UPLOAD_PATH/$PACKAGE_NAME ];then
# å…³æœåŠ¡
    stop

check_ok &quot;stop $SERVICE_NAME&quot;
# åˆ¤æ–­å®‰è£…ç›®å½•æ˜¯å¦å­˜åœ¨

    test -d $DEPLOY_PATH || mkdir -p $_ 
    backup

    mv $UPLOAD_PATH/$PACKAGE_NAME $DEPLOY_PATH
# èµ·æœåŠ¡
    start

    else 

	echo -e &quot; \033[31m there is no new package in $UPLOAD_PATH \033[0m&quot;
	exit 1
    fi
}

function rollback() {

# åœæœåŠ¡
stop
# åˆ é™¤å®‰è£…ç›®å½•ä¸­çš„åŒ…
test -f $PACKAGE_PATH &amp;&amp; rm -f $_
# å›æ»šä¸Šä¸€ä¸ªåŒ…
test -f $BACKUP_PATH/$BACKUP_LAST_NAME &amp;&amp; mv $_ $PACKAGE_PATH
# èµ·æœåŠ¡
start
}



function start() {

# å…ˆåˆ¤æ–­javaæ˜¯å¦å­˜åœ¨
    check_cmd java

#local  PID=$(pgrep -f $PACKAGE_NAME)

    get_pid

    if [ ${PID} ]; then
    echo -e  &quot; $SERVICE_NAME is running, please run \033[34m $0 stop \033[0m first&quot;
    exit 1
    fi

# å…ˆåˆ¤æ–­æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨
	
    test -d $DEPLOY_PATH/logs || mkdir -p $_ 

    cd $DEPLOY_PATH/logs

    test -f $LOG_NAME || touch $_
# åˆ¤æ–­å®‰è£…ç›®å½•ä¸­æ˜¯å¦æœ‰åŒ…

    test -f $PACKAGE_PATH || { echo &quot;there is no package in $_&quot;;exit 1;}

    nohup java -jar $PACKAGE_PATH --spring.profiles.active=$ACTIVE  &gt; $LOG_PATH 2&gt;&amp;1 &amp;

    check_ok &quot;running java -jar ...&quot;

    echo -e  &quot;$SERVICE_NAME \033[34m Started \033[0m&quot;

    echo  -e &quot;æŸ¥çœ‹æ—¥å¿—å‘½ä»¤ï¼š\033[34m $0 log \033[0m æˆ–è€… \033[34m  tail -f $LOG_PATH \033[0m&quot;
}

function stop() {

#local  PID=$(pgrep -f $PACKAGE_NAME)

    get_pid

    if [ ${PID} ]; then
    echo $SERVICE_NAME 'Stop Process'[${PID}]
    kill -15 $PID
    fi

    sleep 5
    
# local  PID=$(pgrep -f $PACKAGE_NAME)

    get_pid

    if [ ${PID} ]; then
        echo $SERVICE_NAME' Kill Process'[${PID}]
        kill -9 $PID
    else
        echo $SERVICE_NAME' Stop Success!'
    fi
}

function status(){

#local  PID=$(pgrep -f $PACKAGE_NAME)

    get_pid

    if [ &quot;$PID&quot; != &quot;&quot; ]; then
        echo -e &quot;$SERVICE_NAME is \033[34m Running \033[0m [$PID] &quot;
    else
        echo -e &quot;$SERVICE_NAME is \033[31m Stopped \033[0m &quot;
    fi
}

function log(){

	tail -100f $LOG_PATH
}

function usage(){

   echo &quot;========================================================================================&quot;
   echo -e &quot;\033[34m usage: $0 [option] ... [start | stop | status | restart | log | upgrade]\033[0m&quot;
   echo -e &quot;\033[34m bash $0 start \033[0m       : start service&quot;
   echo -e &quot;\033[34m bash $0 stop \033[0m        : stop service&quot;
   echo -e &quot;\033[34m bash $0 status \033[0m      : service status&quot;
   echo -e &quot;\033[34m bash $0 log \033[0m         : service log&quot;
   echo -e &quot;\033[34m bash $0 restart \033[0m     : restart service&quot;
   echo -e &quot;\033[34m bash $0 upgrade/up\033[0m   : upgrade service&quot;	# å‡çº§æœåŠ¡
   echo -e &quot;\033[34m bash $0 rollback/back\033[0m: rollback service&quot;	# å›æ»šæœåŠ¡
   echo &quot;========================================================================================&quot;

   

   RETVAL=&quot;2&quot;
}

RETVAL=&quot;0&quot;

case &quot;$1&quot; in
    start)
	get_pid
	if [ $PID ];then
        echo -e &quot; $SERVICE_NAME is running, please run \033[34m $0 stop \033[0m or \033[34m $0 restart \033[0m&quot;
        else
	start
	fi
        ;;
    stop)
	echo &quot;will stop $SERVICE_NAME&quot;
        stop
        ;;
    restart)
	echo &quot;will stop $SERVICE_NAME&quot;
	stop
	echo &quot;will start $SERVICE_NAME&quot;
	start
        ;;
    upgrade|up)
	echo &quot;will upgrade $SERVICE_NAME&quot;
	upload
        ;;
    log)
        log
        ;;
    status)
        status
        ;;
    rollback|back)
	echo &quot;will rollback to the last version&quot;
        rollback
        ;;
    *)
       usage 
        ;;
esac

exit $RETVAL
</code></pre>

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

            <section class="related section">
              
              <article class="prev grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://images.unsplash.com/photo-1554306274-f23873d9a26c?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=750&amp;q=80');"></div>
                 <a href="https://ixwu.github.io/howto-setup-elasticsearch-6.2.2-in-centos/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2018-12-31">2018-12-31</time>
                  <h4 class="title white no-margin">Centos7ä¸Šå®‰è£… elasticsearch-6.2.2åŠç›¸å…³æ’ä»¶</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://ixwu.github.io/media/images/left-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              
              
              <article class="next grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://images.unsplash.com/photo-1550439062-609e1531270e?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=750&amp;q=80');"></div>
                 <a href="https://ixwu.github.io/howto-compile-GraphicsMagick-1.3.28/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2018-12-26">2018-12-26</time>
                  <h4 class="title white no-margin">ç¼–è¯‘å®‰è£…GraphicsMagick-1.3.28</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://ixwu.github.io/media/images/right-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
              <div id="comments" class="bg-white hosted ">
                <div class="clear"></div>
<script>
jQuery(document).ready(function($){
    $('.vemoji-btn').text('ğŸ˜€');
    $("#comments").on('click', 'span.vat',function(){
        $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
        $('textarea#veditor').focus();
    })
    if(window.location.hash){
        var checkExist = setInterval(function() {
            if ($(window.location.hash).length) {
                $('html, body').animate({scrollTop: $(window.location.hash).offset().top-200}, 600);
                clearInterval(checkExist);
            }
        }, 100);
    }
})
</script>

              </div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">æœ€æ–°æ–‡ç« </h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://ixwu.github.io/howto-quickly-make-a-tool-for-xhup/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://www.flypy.com/images/hebu.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-05-03">2020-05-03</time>
                      <h4 class="title usmall">
                        <a href="https://ixwu.github.io/howto-quickly-make-a-tool-for-xhup/">å¦‚ä½•å¿«é€Ÿå¼€å‘ä¸€æ¬¾å°é¹¤åŒæ‹¼æŸ¥è¯¢å·¥å…·</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://ixwu.github.io/howto-graciously-bb-in-ios/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('http://omz-software.com/pythonista/images/DeviceScreenshots.png');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-05-01">2020-05-01</time>
                      <h4 class="title usmall">
                        <a href="https://ixwu.github.io/howto-graciously-bb-in-ios/">å¦‚ä½•åœ¨iOSç«¯ä¼˜é›…åœ°bbï¼Ÿ</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://ixwu.github.io/howto-graciously-bb-in-mac/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://images.unsplash.com/photo-1522021140916-00ca89bfe033?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1050&amp;q=80');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-04-27">2020-04-27</time>
                      <h4 class="title usmall">
                        <a href="https://ixwu.github.io/howto-graciously-bb-in-mac/">å¦‚ä½•åœ¨Macä¸Šä½¿ç”¨uToolsä¼˜é›…åœ°bbï¼Ÿ</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">æ ‡ç­¾äº‘</h4>
                  <div class="tagcloud">
                    
                      <a href="https://ixwu.github.io/tag/zhe-teng/" class="ctag ctag-0 ctag-zhe-teng" aria-label="">æŠ˜è…¾</a>
                    
                      <a href="https://ixwu.github.io/tag/notion/" class="ctag ctag-1 ctag-notion" aria-label="">notion</a>
                    
                      <a href="https://ixwu.github.io/tag/k8s/" class="ctag ctag-2 ctag-k8s" aria-label="">k8s</a>
                    
                      <a href="https://ixwu.github.io/tag/kubeadm/" class="ctag ctag-3 ctag-kubeadm" aria-label="">kubeadm</a>
                    
                      <a href="https://ixwu.github.io/tag/jupyter/" class="ctag ctag-4 ctag-jupyter" aria-label="">Jupyter</a>
                    
                      <a href="https://ixwu.github.io/tag/deploy/" class="ctag ctag-5 ctag-deploy" aria-label="">éƒ¨ç½²</a>
                    
                      <a href="https://ixwu.github.io/tag/history/" class="ctag ctag-6 ctag-history" aria-label="">å†å²</a>
                    
                      <a href="https://ixwu.github.io/tag/learn/" class="ctag ctag-7 ctag-learn" aria-label="">å­¦ä¹ </a>
                    
                      <a href="https://ixwu.github.io/tag/shell/" class="ctag ctag-8 ctag-shell" aria-label="">shell</a>
                    
                      <a href="https://ixwu.github.io/tag/command-line/" class="ctag ctag-9 ctag-command-line" aria-label="">å‘½ä»¤è¡Œ</a>
                    
                      <a href="https://ixwu.github.io/tag/vim/" class="ctag ctag-10 ctag-vim" aria-label="">vim</a>
                    
                      <a href="https://ixwu.github.io/tag/old-article/" class="ctag ctag-11 ctag-old-article" aria-label="">æ—§æ–‡</a>
                    
                      <a href="https://ixwu.github.io/tag/wang-xiao-bo/" class="ctag ctag-12 ctag-wang-xiao-bo" aria-label="">ç‹å°æ³¢</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">å…³äºæˆ‘</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(https://ixwu.github.io/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="">ä¹ å¾å­¦</a></h4>
                    <p class="founder">A Life-long Learner</p>
                    <div class="social">
                      
                          
                            <a href="https://github.com/imxw" class="translate-effect" target="_blank"><i class="fa fa-github"></i></a>
                        
                      
                          
                            <a href="https://twitter.com/ixw1991" class="translate-effect" target="_blank"><i class="fa fa-twitter"></i></a>
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href="https://ixwu.github.io"><img src="/media/images/custom-footerLogo.png" alt=""></a>
        </div>
        <p class="published border-effect">
          Â©2019 å…± 23 ç¯‡æ–‡ç« 
          <br/>
          Theme <a href="https://gridea.dev/" target="_blank">ã€Œbreekã€</a> Powered by <a href="https://gridea.dev/" target="_blank">ã€ŒGrideaã€</a>
        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/valine/1.3.10/Valine.Pure.min.js"></script>
<script>
    new Valine({
        el: '#comments',
        appId: 'RGYOfzCpcS6pfauthuh4L4Td-gzGzoHsz' ,
        appKey: 'QzGtXIuPFad8kd83rFHKoM1p',
        pageSize: 30,
        placeholder: 'æ—¢ç„¶æ¥äº†ï¼Œé‚£å°±ç•™ä¸ªç—•è¿¹å§~',
        visitor: false // é˜…è¯»é‡ç»Ÿè®¡
    })
</script>
    

      
    <script src="https://ixwu.github.io/media/js/functions-post.js"></script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
